<html><head><base href="https://docs.google.com/spreadsheets/d/1-RVXr9sFxJOGmiHmTwqtLkFyykeBBBYPguaED58wVHQ/edit?usp=sharing"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#1a1a1a;color:#fff}.container{max-width:1200px;margin:0 auto;padding:20px;width:100%;position: relative;}.header{background:#2d2d2d;padding:30px;box-shadow:0 4px 15px rgba(0,0,0,.3);margin-bottom:30px;border-radius:15px}.header h1{text-align:center;margin-bottom:20px;color:#fff;transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);transform-origin: center;}.stats-container{display:flex;justify-content:space-between;align-items:center;margin-top:20px;padding:15px;background:rgba(0,0,0,.2);border-radius:10px}.map-count,.area-map-count{color:#fff;font-size:14px}.category-count{color:#fff;font-size:14px}.recommendation{display: flex;align-items: center;justify-content: space-between;gap: 20px;background:#2d2d2d;padding:20px;border-radius:15px;margin:20px 0;box-shadow:0 4px 15px rgba(0,0,0,.3)}.recommendation-content{flex: 1;}.recommendation-animation{width: 100px;height: 100px;flex-shrink: 0;}.recommendation h3{color:#fff;margin-bottom:15px;text-transform:uppercase;}.recommendation p{color:#ddd;line-height:1.6}.home-btn{position:static;display:none;padding:10px 20px;background:linear-gradient(135deg,#a8030a,#c91f27);border:none;border-radius:10px;color:#fff;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,.3);transition:all .3s;margin-top:10px;margin-bottom:20px}.home-btn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,.4);background:linear-gradient(135deg,#c91f27,#a8030a)}.recent-reads{margin:20px 0;padding:20px;background:#2d2d2d;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.3)}.recent-reads h2{margin-bottom:15px;color:#fff}.recent-books{display:flex;gap:20px;overflow-x:auto;padding:10px 0}.recent-book{min-width:150px;background:#333;border-radius:10px;padding:10px;transition:transform .3s;cursor:pointer}.recent-book:hover{transform:scale(1.05)}.recent-book img{width:100%;height:200px;object-fit:cover;border-radius:8px}.recent-book h4{font-size:14px;margin-top:10px;color:#fff}.recent-book .map-category{display:block;font-size:12px;color:#888;margin-top:4px;}.search-container{display:flex;justify-content:center;margin:20px 0}.search-box{position:relative;width:80%;z-index:101;}.search-input{width:100%;padding:15px 20px;font-size:16px;border:2px solid #444;border-radius:30px;outline:none;transition:all .3s;background:#333;color:#fff;box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);}.search-input:focus{border-color:#444;box-shadow:0 0 25px rgba(168, 3, 10, 0.3);}.search-icon{position:absolute;right:20px;top:50%;transform:translateY(-50%);color:#888}.search-preview{position:absolute;top:100%;left:0;width:100%;background:#333;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.3);max-height:300px;overflow-y:auto;transform:none;display:none;z-index:100;margin-top:5px;}.preview-item{padding:12px 20px;border-bottom:1px solid #444;cursor:pointer;transition:all .3s;display: flex;flex-direction: column;gap: 4px;}.preview-item:hover{background:#444;}.preview-item:last-child{border-bottom:none;}.preview-item small{font-size:12px;opacity:0.7;}.tabs{display:flex;gap:10px;margin:20px 0;flex-wrap:wrap;justify-content:center}.tab{padding:12px 24px;background:#2d2d2d;border:none;border-radius:20px;cursor:pointer;transition:all .3s;color:#fff;box-shadow:0 2px 8px rgba(0,0,0,.2)}.tab:hover,.tab.active{background:linear-gradient(135deg,#a8030a,#c91f27);color:#fff;box-shadow:0 4px 12px rgba(168, 3, 10, .3)}.maps-grid { display: flex; flex-direction: column; gap: 15px; padding: 20px; transition: opacity 0.4s ease-in-out, transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); } .map-item { background: #2d2d2d; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; opacity: 0; transform: translateY(20px); transition: all 0.3s ease-out; } .map-item:hover { transform: translateX(10px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4); } .map-cover { display: none; } .iframe-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:1000}.iframe-container{position:fixed;top:0;left:0;width:100%;height:100%;background:#2d2d2d}.close-btn{position:fixed;top:15px;right:15px;background:linear-gradient(135deg,#a8030a,#c91f27);border:none;padding:8px 15px;border-radius:8px;cursor:pointer;color:#fff;z-index:1001;transition:all .3s}.close-btn:hover{background:linear-gradient(135deg,#c91f27,#a8030a);box-shadow:0 4px 12px rgba(168, 3, 10, .3)}.home-content{display:none}.home-content{margin-top:20px;}.recommendation{margin-top:30px;}.area-map-count.highlight { animation: highlightText 1.5s ease-in-out; font-weight: bold; color: #c91f27; } @keyframes highlightText { 0% { transform: scale(1); color: #fff; } 50% { transform: scale(1.1); color: #c91f27; } 100% { transform: scale(1); color: #c91f27; } } .mode-tabs { display: none; } .fade-out { opacity: 0; transform: translateY(20px); } .fade-in { opacity: 1; transform: translateY(0); } @keyframes shakeError { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } } @keyframes successPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } } .password-input { width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #444; border-radius: 10px; background: #1a1a1a; color: #fff; font-size: 16px; transition: all 0.3s ease; } .password-input.error { border-color: #ff4444; animation: shakeError 0.5s ease; } .password-input.success { border-color: #00ff00; animation: successPulse 0.5s ease; } .password-modal { background: rgba(0,0,0,0.95); backdrop-filter: blur(5px); animation: none; } .password-content { background: linear-gradient(145deg, #2d2d2d, #222); box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; } .password-content.error { animation: shakeError 0.5s ease; box-shadow: 0 0 20px rgba(255, 0, 0, 0.5); border: 1px solid #ff4444; } .password-content.success { animation: successPulse 0.5s ease; box-shadow: 0 0 20px rgba(0, 255, 0, 0.5); border: 1px solid #00ff00; } .premium-badge { position: fixed; top: 20px; right: 20px; background: linear-gradient(135deg, #DAA520, #FFD700); padding: 5px 10px; border-radius: 15px; color: #333; font-size: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); display: flex; align-items: center; gap: 5px; z-index: 1000; opacity: 0.8; } .premium-badge i { color: #333; font-size: 12px; } @media (max-width: 768px) {.search-box { width: 90%; }}.recent-book button { padding: 8px 20px; background: linear-gradient(135deg,#DAA520,#FFD700); border: none; border-radius: 8px; color: #000; cursor: pointer; transition: all 0.3s; margin-top: 10px; } #premium-button:hover { transform: scale(1.05); box-shadow: 0 4px 15px rgba(218,165,32,0.4); } #cancel-premium:hover { background: #555; } #premium-button { background: linear-gradient(135deg,#a8030a,#c91f27) !important; color: #fff !important; } </style></head><body><div class="container"><div style="text-align: left; font-size: 12px; color: #888; margin-bottom: 10px;" id="last-update"></div><button class="home-btn" onclick="showHome()"><i class="fas fa-home"></i> In&iacute;cio</button><div class="header"><h1>Biblioteca de Mapas Mentais</h1><div style="text-align: center; font-size: 12px; color: #888; margin-bottom: 15px;">Organize seus estudos com mapas mentais</div><div style="display: flex; justify-content: center; margin-bottom: 20px;"><iframe src="https://lottie.host/embed/4e97110d-f367-4019-a88b-5916876261bb/cfCNJrZtlo.lottie" style="width: 200px; height: 200px; border: none;" frameborder="0"></iframe></div><div class="search-container"><div class="search-box"><input type="text" class="search-input" placeholder="Pesquisar mapas..."><i class="search-icon fas fa-search"></i></div></div><div class="stats-container"><div class="map-count" id="map-count"></div><div class="category-count" id="category-count"></div><div class="area-map-count" id="area-map-count"></div></div></div><div class="tabs" id="tabs"></div><div id="home-content" class="home-content"><div class="recommendation"><div class="recommendation-content"><h3>REFLITA</h3><p id="daily-recommendation">Carregando recomenda&ccedil;&atilde;o...</p></div><iframe class="recommendation-animation" src="https://lottie.host/embed/727109e7-6fe0-44f8-8e93-d168b2f9f0c2/fi5yyQLYCL.lottie" frameborder="0"></iframe></div></div><div class="maps-grid" id="maps-grid"></div></div><div class="iframe-modal" id="iframe-modal"><div class="iframe-container"><button class="close-btn" onclick="closeModal()">Fechar</button><iframe id="map-iframe" width="100%" height="100%" frameborder="0"></iframe></div></div><script src="https://kit.fontawesome.com/a076d05399.js"></script><script>const USER_STORAGE_KEY = 'user_download_stats';
const FREE_DOWNLOAD_LIMIT = 10;
const isAndroid = /Android/i.test(navigator.userAgent);
const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
const isSubscriber = localStorage.getItem('isSubscriber') === 'true';
let userStats = JSON.parse(localStorage.getItem(USER_STORAGE_KEY)) || {
  downloads: 0,
  lastReset: new Date().getTime()
};
function checkAndResetMonthlyCounts() {
  const now = new Date().getTime();
  const thirtyDays = 30 * 24 * 60 * 60 * 1000;
  if (now - userStats.lastReset > thirtyDays) {
    userStats = {
      downloads: 0,
      lastReset: now
    };
    localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
  }
}
const API_KEY = 'AIzaSyCbD-rljbYoW1suOkyq8-ZA__BTtT7UCfU';
const SPREADSHEET_ID = '1hxXYVgEclEoXuwCRlVxyL57wxZ9PdpeWd2qBLKOCHII';
let downloadMaps = {};
const DOWNLOAD_SPREADSHEET_ID = '1NJSOtgvZE-ckuXX0JQEBaBctKSa5T02I_nZ8iQc8IGY';
let currentMode = 'view';
const maps = {};
let currentTab = '';
let sheets = [];
let phrases = [];
const recentReads = JSON.parse(localStorage.getItem('recentReads')) || [];
async function loadAccessPhrases() {
  const PHRASES_SPREADSHEET_ID = '1qIJtMbbCd75XpX3P7TBmZX7MqMxvTerXZkVnGCDWlcA';
  try {
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${PHRASES_SPREADSHEET_ID}/values/nova!A:A?key=${API_KEY}`);
    const data = await response.json();
    return data.values?.slice(1).map(row => row[0]) || [];
  } catch (error) {
    console.error('Error loading access phrases:', error);
    return [];
  }
}
function formatDate(date) {
  return date.toLocaleDateString('pt-BR', {
    day: '2-digit',
    month: '2-digit',
    year: 'numeric'
  });
}
function updateLastUpdateDate() {
  const lastUpdateElement = document.getElementById('last-update');
  const now = new Date();
  let lastUpdate = localStorage.getItem('lastUpdateDate');
  if (!lastUpdate || now - new Date(lastUpdate) > 3 * 24 * 60 * 60 * 1000) {
    lastUpdate = now.toISOString();
    localStorage.setItem('lastUpdateDate', lastUpdate);
  }
  lastUpdateElement.textContent = `&Uacute;ltima atualiza&ccedil;&atilde;o: ${formatDate(new Date(lastUpdate))}`;
}
async function loadPhrases() {
  try {
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/frases?key=${API_KEY}`);
    const data = await response.json();
    if (data.values) {
      phrases = data.values.slice(1).map(row => row[0]);
    }
  } catch (error) {
    console.error('Error loading phrases:', error);
  }
}
function getDailyRecommendation() {
  if (phrases.length > 0) {
    const randomIndex = Math.floor(Math.random() * phrases.length);
    document.getElementById('daily-recommendation').textContent = phrases[randomIndex];
  } else {
    const recommendations = ['Dedique pelo menos 30 minutos &agrave; leitura hoje para melhorar seu conhecimento jur&iacute;dico.', 'A leitura di&aacute;ria &eacute; fundamental para se manter atualizado com as mudan&ccedil;as na legisla&ccedil;&atilde;o.', 'Experimente ler sobre uma &aacute;rea do direito diferente hoje para expandir seus horizontes.'];
    const randomIndex = Math.floor(Math.random() * recommendations.length);
    document.getElementById('daily-recommendation').textContent = recommendations[randomIndex];
  }
}
async function loadSheetData() {
  try {
    const readResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`);
    const readData = await readResponse.json();
    sheets = readData.sheets;
    
    const downloadResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${DOWNLOAD_SPREADSHEET_ID}?key=${API_KEY}`);
    const downloadData = await downloadResponse.json();
    
    const tabsContainer = document.getElementById('tabs');
    tabsContainer.innerHTML = '';
    
    sheets.forEach(sheet => {
      if (sheet.properties.title.toLowerCase() !== 'frases') {
        const tabButton = document.createElement('button');
        tabButton.className = 'tab';
        tabButton.textContent = sheet.properties.title;
        
        tabButton.onclick = () => {
          try {
            changeTab(sheet.properties.title);
          } catch (error) {
            console.error('Error changing tab:', error);
          }
        };
        
        tabsContainer.appendChild(tabButton);
        loadSheetContent(sheet.properties.title);
        loadDownloadContent(sheet.properties.title);
      }
    });
    
    loadPhrases();
    showHome();
  } catch (error) {
    console.error('Error loading spreadsheet:', error);
  }
}
async function loadDownloadContent(sheetName) {
  try {
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${DOWNLOAD_SPREADSHEET_ID}/values/${sheetName}?key=${API_KEY}`);
    const data = await response.json();
    downloadMaps[sheetName] = data.values.slice(1).map(row => ({
      title: row[0],
      link: row[1],
      cover: row[2]
    }));
  } catch (error) {
    console.error('Error loading download content:', error);
  }
}
function showHome() {
  document.getElementById('home-content').style.display = 'block';
  document.getElementById('maps-grid').style.display = 'none';
  document.getElementById('tabs').style.display = 'flex';
  document.querySelector('.home-btn').style.display = 'none';
  getDailyRecommendation();
}
function switchMode(mode) {
  const mainTitle = document.querySelector('.header h1');
  const mapsGrid = document.getElementById('maps-grid');
  const tabs = document.querySelectorAll('.mode-tab');
  mapsGrid.classList.add('fade-out');
  mainTitle.style.transform = 'scale(0.95)';
  mainTitle.style.opacity = '0';
  tabs.forEach(tab => {
    if (tab.dataset.mode === mode) {
      tab.classList.add('active');
      tab.style.transform = 'scale(1.05)';
      setTimeout(() => tab.style.transform = 'scale(1)', 200);
    } else {
      tab.classList.remove('active');
    }
  });
  setTimeout(() => {
    currentMode = mode;
    mainTitle.textContent = mode === 'view' ? 'Biblioteca de Mapas Mentais' : 'Download de Mapas';
    if (mode === 'view') {
      if (currentTab) {
        displayMaps(maps[currentTab]);
      } else {
        showHome();
      }
    } else {
      if (currentTab) {
        displayMaps(downloadMaps[currentTab]);
      }
    }
    requestAnimationFrame(() => {
      mainTitle.style.transform = 'scale(1)';
      mainTitle.style.opacity = '1';
      mapsGrid.classList.remove('fade-out');
      mapsGrid.classList.add('fade-in');
    });
  }, 400);
}
function changeTab(tabName) {
  if (!maps[tabName] && !downloadMaps[tabName]) {
    console.error(`No maps found for tab: ${tabName}`);
    return;
  }

  currentTab = tabName;
  document.getElementById('home-content').style.display = 'none';
  document.getElementById('maps-grid').style.display = 'flex';
  
  const recentReadsSection = document.getElementById('recent-reads-section');
  if (recentReadsSection) {
    recentReadsSection.style.display = 'none';
  }
  
  document.getElementById('tabs').style.display = 'none';
  document.querySelector('.home-btn').style.display = 'inline-block';
  
  document.querySelectorAll('.tab').forEach(tab => {
    tab.classList.toggle('active', tab.textContent === tabName);
  });
  
  const mapList = currentMode === 'view' ? (maps[tabName] || []) : (downloadMaps[tabName] || []);
  const areaMapCount = document.getElementById('area-map-count');
  
  areaMapCount.textContent = `Mapas nesta &aacute;rea: ${mapList.length}`;
  areaMapCount.classList.remove('highlight');
  void areaMapCount.offsetWidth;
  areaMapCount.classList.add('highlight');
  
  displayMaps(mapList);
}
async function loadSheetContent(sheetName) {
  try {
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheetName}?key=${API_KEY}`);
    const data = await response.json();
    maps[sheetName] = data.values.slice(1).map(row => ({
      title: row[0],
      link: row[1],
      cover: row[2]
    }));
    updateMapCount();
    if (currentTab === sheetName) {
      document.getElementById('area-map-count').textContent = `Mapas nesta &aacute;rea: ${maps[sheetName].length}`;
    }
  } catch (error) {
    console.error('Error loading sheet content:', error);
  }
}
function updateMapCount() {
  const totalMaps = Object.values(maps).reduce((total, categoryMaps) => total + categoryMaps.length, 0);
  document.getElementById('map-count').textContent = `Total de Mapas: ${totalMaps}`;
}
function checkPassword(link, title, cover) {
  checkAndResetMonthlyCounts();
  if (localStorage.getItem('isSubscriber') === 'true') {
    window.open(link, '_blank');
    return;
  }
  if (userStats.downloads >= FREE_DOWNLOAD_LIMIT) {
    showPremiumPrompt();
    return;
  }
  userStats.downloads++;
  localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
  window.open(link, '_blank');
}
function handleDownload(link, title, cover) {
  const premiumBadge = document.querySelector('.premium-badge');
  if (premiumBadge) {
    premiumBadge.style.display = 'none';
  }
  if (localStorage.getItem('isSubscriber') === 'true') {
    window.open(link, '_blank');
    return;
  }
  checkAndResetMonthlyCounts();
  if (userStats.downloads >= FREE_DOWNLOAD_LIMIT) {
    showPremiumPrompt();
  } else {
    userStats.downloads++;
    localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
    window.open(link, '_blank');
  }
}
function showPremiumPrompt() {
  const modal = document.createElement('div');
  modal.className = 'password-modal';
  modal.style.cssText = ` position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; z-index: 2000; `;
  const content = document.createElement('div');
  content.className = 'password-content';
  content.style.cssText = ` padding: 40px; border-radius: 20px; width: 90%; max-width: 400px; text-align: center; `;
  content.innerHTML = ` <div style="position: relative;"> <iframe src="https://lottie.host/embed/727109e7-6fe0-44f8-8e93-d168b2f9f0c2/fi5yyQLYCL.lottie" style="width: 120px; height: 120px; margin: -20px auto 20px;" frameborder="0"></iframe> <h3 style="color: #fff; font-size: 24px; margin-bottom: 20px;">Limite Atingido!</h3> <p style="color: #ddd; margin-bottom: 25px; font-size: 16px;"> Voc&ecirc; atingiu o limite de downloads gratuitos.<br> Seja premium para acessar mais de 130 mapas mentais! </p> <button id="premium-button" style=" padding: 12px 25px; background: linear-gradient(135deg,#DAA520,#FFD700); border: none; border-radius: 10px; color: #000; cursor: pointer; font-weight: bold; transition: all 0.3s; "> Seja Premium - R$29,99 </button> <button id="cancel-premium" style=" padding: 12px 25px; background: #444; border: none; border-radius: 10px; color: #fff; cursor: pointer; margin-top: 15px; transition: all 0.3s; ">Cancelar</button> </div> `;
  content.innerHTML = content.innerHTML.replace(`background: linear-gradient(135deg,#DAA520,#FFD700);`, `background: linear-gradient(135deg,#a8030a,#c91f27);`).replace(`color: #000;`, `color: #fff;`);
  modal.appendChild(content);
  document.body.appendChild(modal);
  document.getElementById('premium-button').onclick = () => {
    const storeUrl = isAndroid ? 'https://play.google.com/store/apps/details?id=br.com.app.gpu2994564.gpub492f9e6db037057aaa93d7adfa9e3e0' : 'https://apps.apple.com/us/app/direito-premium/id6451451647';
    window.open(storeUrl, '_blank');
    document.body.removeChild(modal);
  };
  document.getElementById('cancel-premium').onclick = () => {
    document.body.removeChild(modal);
  };
}
function displayMaps(mapsList) {
  const grid = document.getElementById('maps-grid');
  grid.style.display = 'flex';
  grid.style.flexDirection = 'column';
  grid.style.gap = '15px';
  grid.innerHTML = '';
  mapsList?.forEach((map, index) => {
    const formattedTitle = map.title.replace('.pdf', '').replace(/(\\d+)/g, '<strong>$1</strong>');
    const item = document.createElement('div');
    item.className = 'map-item';
    item.style.cssText = ` background: #2d2d2d; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; opacity: 0; transform: translateY(20px); transition: all 0.3s ease-out ${index * 50}ms; `;
    item.innerHTML = ` <h3 style="color: #fff; margin: 0;">${formattedTitle}</h3> <button onclick="checkPassword('${map.link}','${map.title}','')" style=" padding: 8px 20px; background: linear-gradient(135deg,#a8030a,#c91f27); border: none; border-radius: 8px; color: #fff; cursor: pointer; transition: all 0.3s;">Download</button> `;
    grid.appendChild(item);
    requestAnimationFrame(() => {
      item.style.opacity = '1';
      item.style.transform = 'translateY(0)';
    });
  });
}
function updateRecentReads() {}
function openMap(link, title, cover) {
  const modal = document.getElementById('iframe-modal');
  const iframe = document.getElementById('map-iframe');
  const premiumBadge = document.querySelector('.premium-badge');
  if (premiumBadge) {
    premiumBadge.style.display = 'none';
  }
  document.querySelector('.home-btn').style.display = 'none';
  iframe.src = link;
  modal.style.display = 'block';
  let mapCategory = '';
  for (const category in maps) {
    if (maps[category].some(m => m.link === link)) {
      mapCategory = category;
      break;
    }
  }
  const mapData = {
    title,
    link,
    cover,
    category: mapCategory,
    timestamp: Date.now()
  };
  const existingIndex = recentReads.findIndex(map => map.link === link);
  if (existingIndex > -1) {
    recentReads.splice(existingIndex, 1);
  }
  recentReads.unshift(mapData);
  if (recentReads.length > 5) {
    recentReads.pop();
  }
  localStorage.setItem('recentReads', JSON.stringify(recentReads));
  updateRecentReads();
}
function closeModal() {
  const modal = document.getElementById('iframe-modal');
  const iframe = document.getElementById('map-iframe');
  const homeBtn = document.querySelector('.home-btn');
  const premiumBadge = document.querySelector('.premium-badge');
  iframe.src = '';
  modal.style.display = 'none';
  homeBtn.style.display = 'inline-block';
  if (premiumBadge && localStorage.getItem('isSubscriber') === 'true') {
    premiumBadge.style.display = 'flex';
  }
}
function normalizeText(text) {
  return text.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}
document.querySelector('.search-input').addEventListener('input', e => {
  const searchTerm = normalizeText(e.target.value);
  const searchBox = document.querySelector('.search-box');
  const existingPreview = document.querySelector('.search-preview');
  if (existingPreview) {
    existingPreview.remove();
  }
  if (searchTerm === '') {
    if (currentTab) {
      displayMaps(currentMode === 'view' ? maps[currentTab] : downloadMaps[currentTab]);
      document.getElementById('tabs').style.display = 'none';
      document.querySelector('.home-btn').style.display = 'inline-block';
    } else {
      document.getElementById('maps-grid').style.display = 'none';
      document.getElementById('home-content').style.display = 'block';
      document.getElementById('tabs').style.display = 'flex';
      document.querySelector('.home-btn').style.display = 'none';
    }
    return;
  }
  document.querySelector('.home-btn').style.display = 'inline-block';
  const previewContainer = document.createElement('div');
  previewContainer.className = 'search-preview';
  const allMatches = [];
  const sourceMaps = currentMode === 'view' ? maps : downloadMaps;
  Object.entries(sourceMaps).forEach(([category, categoryMaps]) => {
    categoryMaps.forEach(map => {
      const normalizedTitle = normalizeText(map.title);
      if (normalizedTitle.includes(searchTerm)) {
        allMatches.push({
          ...map,
          category
        });
      }
    });
  });
  allMatches.slice(0, 5).forEach(map => {
    const formattedTitle = map.title.replace('.pdf', '').replace(/(\\d+)/g, '<strong>$1</strong>');
    const previewItem = document.createElement('div');
    previewItem.className = 'preview-item';
    previewItem.innerHTML = `<div>${formattedTitle}</div><small style="color: #888;">${map.category}</small>`;
    previewItem.onclick = () => {
      checkPassword(map.link, map.title, map.cover);
    };
    previewContainer.appendChild(previewItem);
  });
  if (allMatches.length > 0) {
    previewContainer.style.display = 'block';
    searchBox.appendChild(previewContainer);
  }
  document.getElementById('maps-grid').style.display = 'flex';
  document.getElementById('home-content').style.display = 'none';
  displayMaps(allMatches);
});
document.addEventListener('click', e => {
  const searchBox = document.querySelector('.search-box');
  const searchPreview = document.querySelector('.search-preview');
  if (!searchBox.contains(e.target) && searchPreview) {
    searchPreview.remove();
  }
});
loadSheetData();
getDailyRecommendation();
updateLastUpdateDate();
document.addEventListener('DOMContentLoaded', () => {
  showPremiumBadge();
});
function showPremiumBadge() {
  if (localStorage.getItem('isSubscriber') === 'true') {
    const badge = document.createElement('div');
    badge.className = 'premium-badge';
    badge.innerHTML = ` <i class="fas fa-crown"></i> Premium `;
    document.body.appendChild(badge);
  }
}</script></body></html>
